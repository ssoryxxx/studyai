<!DOCTYPE html>
<!-- saved from url=(0055)file:///C:/Users/ssoryxxx/Downloads/study-ai-app_1.html -->
<html lang="ru"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="StudyAI">
<title>StudyAI ‚Äî –£—á–µ–±–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫</title>
<link href="./index_files/css2" rel="stylesheet">
<style>
  :root{--bg:#080810;--s1:#11111d;--s2:#181826;--border:rgba(255,255,255,0.07);--accent:#8b7cff;--accent2:#ff7eb3;--accent3:#5fffd4;--warn:#ffd166;--text:#eeeef8;--muted:#5a5a70;--radius:18px;--safe-t:env(safe-area-inset-top,0px);--safe-b:env(safe-area-inset-bottom,0px)}
  *{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent}
  body{font-family:'DM Sans',sans-serif;background:var(--bg);color:var(--text);height:100dvh;display:flex;flex-direction:column;overflow:hidden;position:fixed;width:100%}
  .hdr{padding:calc(var(--safe-t) + 10px) 18px 10px;background:rgba(8,8,16,.94);backdrop-filter:blur(24px);-webkit-backdrop-filter:blur(24px);border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;flex-shrink:0;z-index:20}
  .logo{font-family:'Syne',sans-serif;font-weight:800;font-size:1.25rem;background:linear-gradient(130deg,var(--accent),var(--accent2));-webkit-background-clip:text;-webkit-text-fill-color:transparent;letter-spacing:-.02em}
  .logo span{font-size:.68em;opacity:.55}
  .hdr-right{display:flex;gap:8px}
  .ibtn{width:36px;height:36px;border-radius:11px;background:var(--s1);border:1px solid var(--border);color:var(--muted);display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:.95rem;transition:all .18s}
  .ibtn:active{transform:scale(.92);background:var(--s2)}
  .sbar{display:flex;gap:7px;padding:9px 14px;overflow-x:auto;scrollbar-width:none;border-bottom:1px solid var(--border);background:var(--bg);flex-shrink:0}
  .sbar::-webkit-scrollbar{display:none}
  .pill{flex-shrink:0;padding:5px 13px;border-radius:100px;font-size:.78rem;font-weight:500;border:1px solid var(--border);background:var(--s1);color:var(--muted);cursor:pointer;transition:all .18s;white-space:nowrap}
  .pill.on{background:var(--accent);color:#fff;border-color:var(--accent);font-weight:600}
  .pill.bs-pill.on{background:linear-gradient(135deg,#00b4d8,#0077b6);border-color:#00b4d8}
  .pill.ts-pill.on{background:linear-gradient(135deg,#22c55e,#16a34a);border-color:#22c55e}
  .pill:active{transform:scale(.95)}
  .status{padding:7px 16px;font-size:.78rem;text-align:center;display:none;flex-shrink:0}
  .status.err{display:block;color:#ff7878;background:rgba(255,100,100,.07);border-bottom:1px solid rgba(255,100,100,.12)}
  .status.ok{display:block;color:var(--accent3);background:rgba(95,255,212,.06);border-bottom:1px solid rgba(95,255,212,.1)}
  .msgs{flex:1;overflow-y:auto;padding:14px 14px 6px;display:flex;flex-direction:column;gap:12px;scroll-behavior:smooth}
  .msgs::-webkit-scrollbar{display:none}
  .welcome{display:flex;flex-direction:column;align-items:center;justify-content:center;flex:1;text-align:center;padding:16px;animation:fu .5s ease both}
  .wicon{width:68px;height:68px;border-radius:22px;background:linear-gradient(135deg,var(--accent),var(--accent2));display:flex;align-items:center;justify-content:center;font-size:1.9rem;margin-bottom:14px;box-shadow:0 0 44px rgba(139,124,255,.28)}
  .welcome h2{font-family:'Syne',sans-serif;font-weight:700;font-size:1.3rem;margin-bottom:7px}
  .welcome p{color:var(--muted);font-size:.85rem;line-height:1.55;max-width:270px}
  .qas{display:flex;flex-direction:column;gap:7px;margin-top:18px;width:100%;max-width:310px}
  .qa{background:var(--s1);border:1px solid var(--border);border-radius:13px;padding:10px 14px;text-align:left;color:var(--text);font-size:.82rem;cursor:pointer;transition:all .18s;display:flex;align-items:center;gap:9px}
  .qa:active{transform:scale(.98);background:var(--s2)}
  .qi{font-size:1.05rem;flex-shrink:0}
  .msg{display:flex;gap:9px;animation:fu .28s ease both;max-width:100%}
  .msg.usr{flex-direction:row-reverse}
  .av{width:30px;height:30px;border-radius:50%;flex-shrink:0;display:flex;align-items:center;justify-content:center;font-size:.78rem;font-weight:700;margin-top:3px}
  .aiav{background:linear-gradient(135deg,var(--accent),var(--accent2));color:#fff;font-family:'Syne',sans-serif}
  .usrav{background:var(--s2);color:var(--muted);border:1px solid var(--border)}
  .bub{max-width:calc(100% - 46px);padding:11px 14px;border-radius:var(--radius);font-size:.88rem;line-height:1.65;word-break:break-word}
  .aibub{background:var(--s1);border:1px solid var(--border);border-bottom-left-radius:5px}
  .usrbub{background:rgba(139,124,255,.12);border:1px solid rgba(139,124,255,.18);border-bottom-right-radius:5px}
  .bub img{max-width:100%;border-radius:11px;margin-bottom:7px;display:block;max-height:240px;object-fit:contain}
  .imgrid{display:grid;grid-template-columns:repeat(auto-fill,minmax(110px,1fr));gap:5px;margin-bottom:7px}
  .imgrid img{width:100%;height:90px;object-fit:cover;border-radius:9px;border:1px solid var(--border);margin:0}
  .bub strong{color:var(--accent3);font-weight:600}
  .bub em{color:var(--accent2);font-style:italic}
  .bub code{background:rgba(255,255,255,.07);border-radius:5px;padding:1px 5px;font-family:'Courier New',monospace;font-size:.8rem;color:var(--accent3)}
  .bub pre{background:rgba(0,0,0,.45);border-radius:10px;padding:11px;overflow-x:auto;margin:7px 0;border:1px solid var(--border)}
  .bub pre code{background:none;padding:0;font-size:.78rem}
  .bub .ans{background:rgba(95,255,212,.08);border-left:3px solid var(--accent3);border-radius:0 10px 10px 0;padding:8px 12px;margin:7px 0;font-weight:600;color:var(--accent3);font-size:.92rem}
  .sbadge{display:inline-flex;align-items:center;gap:3px;font-size:.69rem;background:rgba(139,124,255,.14);color:var(--accent);border-radius:5px;padding:2px 7px;margin-bottom:5px;font-weight:600}
  .bs-badge{background:rgba(0,180,216,.12);color:#00b4d8}
  .ts-badge{background:rgba(34,197,94,.12);color:#22c55e}
  .typing{display:flex;gap:5px;padding:12px 14px;align-items:center}
  .typing span{width:7px;height:7px;background:var(--accent);border-radius:50%;animation:ty 1.3s ease infinite}
  .typing span:nth-child(2){animation-delay:.2s;background:var(--accent2)}
  .typing span:nth-child(3){animation-delay:.4s;background:var(--accent3)}
  .prevs{display:flex;gap:7px;padding:7px 14px 0;flex-wrap:wrap;flex-shrink:0}
  .prev{position:relative;width:64px;height:64px;border-radius:11px;overflow:hidden;border:1px solid var(--border);animation:fu .2s ease}
  .prev img{width:100%;height:100%;object-fit:cover}
  .prev .rm{position:absolute;top:2px;right:2px;width:17px;height:17px;background:rgba(0,0,0,.75);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:.58rem;cursor:pointer;color:#fff}
  .inp-area{background:rgba(8,8,16,.96);backdrop-filter:blur(24px);-webkit-backdrop-filter:blur(24px);border-top:1px solid var(--border);padding:8px 13px calc(var(--safe-b) + 8px);flex-shrink:0}
  .inp-row{display:flex;gap:7px;align-items:flex-end}
  .inpacts{display:flex;gap:5px;flex-shrink:0}
  .abtn{width:38px;height:38px;border-radius:11px;background:var(--s1);border:1px solid var(--border);color:var(--muted);display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:.95rem;transition:all .18s;flex-shrink:0}
  .abtn:active{transform:scale(.92);background:var(--s2)}
  .twrap{flex:1;background:var(--s1);border:1px solid var(--border);border-radius:14px;display:flex;align-items:flex-end;padding:7px 11px;transition:border-color .2s}
  .twrap:focus-within{border-color:rgba(139,124,255,.4)}
  textarea{flex:1;background:none;border:none;outline:none;color:var(--text);font-family:'DM Sans',sans-serif;font-size:.88rem;resize:none;max-height:110px;min-height:21px;line-height:1.5}
  textarea::placeholder{color:var(--muted)}
  .sbtn{width:38px;height:38px;border-radius:11px;background:linear-gradient(135deg,var(--accent),var(--accent2));border:none;color:#fff;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:1rem;flex-shrink:0;box-shadow:0 3px 14px rgba(139,124,255,.28);transition:all .18s}
  .sbtn:active{transform:scale(.92)}
  .sbtn:disabled{opacity:.35;box-shadow:none}
  .overlay{position:fixed;inset:0;background:rgba(0,0,0,.65);backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);z-index:100;display:none;align-items:flex-end}
  .overlay.open{display:flex;animation:fi .2s ease}
  .panel{width:100%;background:var(--s1);border-radius:26px 26px 0 0;padding:18px 18px calc(var(--safe-b) + 18px);animation:su .32s cubic-bezier(.34,1.56,.64,1);max-height:80dvh;overflow-y:auto}
  .ph{width:38px;height:4px;background:rgba(255,255,255,.12);border-radius:2px;margin:0 auto 18px}
  .ptitle{font-family:'Syne',sans-serif;font-weight:700;font-size:1.15rem;margin-bottom:18px}
  .sg{margin-bottom:16px}
  .sl{font-size:.72rem;color:var(--muted);font-weight:600;letter-spacing:.07em;text-transform:uppercase;margin-bottom:7px}
  .si{width:100%;background:var(--bg);border:1px solid var(--border);border-radius:11px;padding:11px 13px;color:var(--text);font-family:'DM Sans',sans-serif;font-size:.88rem;outline:none;transition:border-color .2s}
  .si:focus{border-color:var(--accent)}
  .mgrid{display:grid;grid-template-columns:1fr 1fr;gap:7px}
  .mopt{background:var(--bg);border:1px solid var(--border);border-radius:11px;padding:9px 11px;cursor:pointer;transition:all .18s;text-align:center}
  .mopt.on{border-color:var(--accent);background:rgba(139,124,255,.1);color:var(--accent)}
  .mopt:active{transform:scale(.97)}
  .mn{font-size:.78rem;font-weight:600}
  .md{font-size:.68rem;color:var(--muted);margin-top:1px}
  .savebtn{width:100%;padding:13px;background:linear-gradient(135deg,var(--accent),var(--accent2));border:none;border-radius:13px;color:#fff;font-family:'Syne',sans-serif;font-weight:700;font-size:.95rem;cursor:pointer;margin-top:6px;transition:opacity .18s}
  .savebtn:active{opacity:.8}
  .clrbtn{width:100%;padding:11px;background:rgba(255,100,100,.08);border:1px solid rgba(255,100,100,.18);border-radius:13px;color:#ff7878;font-family:'DM Sans',sans-serif;font-weight:500;font-size:.86rem;cursor:pointer;margin-top:7px;transition:all .18s}
  .clrbtn:active{background:rgba(255,100,100,.15)}
  .anote{font-size:.72rem;color:var(--muted);margin-top:7px;line-height:1.5}
  .keyscreen{position:fixed;inset:0;background:var(--bg);z-index:200;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:28px;animation:fu .4s ease}
  .keyscreen.hidden{display:none}
  .ksicon{width:76px;height:76px;border-radius:24px;background:linear-gradient(135deg,var(--accent),var(--accent2));display:flex;align-items:center;justify-content:center;font-size:2.2rem;margin-bottom:20px;box-shadow:0 0 50px rgba(139,124,255,.3)}
  .kscard{width:100%;max-width:340px;background:var(--s1);border:1px solid var(--border);border-radius:22px;padding:24px}
  .kscard h2{font-family:'Syne',sans-serif;font-weight:800;font-size:1.2rem;margin-bottom:6px}
  .kscard p{color:var(--muted);font-size:.82rem;line-height:1.55;margin-bottom:18px}
  .ksinp{width:100%;background:var(--bg);border:1.5px solid var(--border);border-radius:12px;padding:12px 14px;color:var(--text);font-family:'DM Sans',sans-serif;font-size:.85rem;outline:none;transition:border-color .2s;margin-bottom:10px}
  .ksinp:focus{border-color:var(--accent)}
  .ksinp::placeholder{color:var(--muted)}
  .ksbtn{width:100%;padding:13px;background:linear-gradient(135deg,var(--accent),var(--accent2));border:none;border-radius:13px;color:#fff;font-family:'Syne',sans-serif;font-weight:700;font-size:.95rem;cursor:pointer;transition:opacity .18s}
  .ksbtn:active{opacity:.8}
  .kslink{display:block;text-align:center;margin-top:12px;font-size:.75rem;color:var(--muted)}
  .kslink a{color:var(--accent);text-decoration:none}
  .kserr{font-size:.76rem;color:#ff7878;margin-bottom:8px;display:none}
  .kserr.show{display:block}
  @keyframes fu{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
  @keyframes fi{from{opacity:0}to{opacity:1}}
  @keyframes su{from{transform:translateY(100%)}to{transform:translateY(0)}}
  @keyframes ty{0%,60%,100%{transform:translateY(0);opacity:.4}30%{transform:translateY(-6px);opacity:1}}
</style>
</head>
<body>

<div class="keyscreen" id="keyscreen">
  <div class="ksicon">üîë</div>
  <div class="kscard">
    <h2>–í–≤–µ–¥–∏ API –∫–ª—é—á</h2>
    <p>–ö–ª—é—á —Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ —Ç–≤–æ—ë–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ. –ù–∏–∫—Ç–æ –∫—Ä–æ–º–µ —Ç–µ–±—è –µ–≥–æ –Ω–µ —É–≤–∏–¥–∏—Ç ‚Äî –≤ –∫–æ–¥–µ –µ–≥–æ –Ω–µ—Ç.</p>
    <div class="kserr" id="kserr">‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –∫–ª—é—á –∏–ª–∏ –Ω–µ—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞. –ü–æ–ø—Ä–æ–±—É–π –µ—â—ë —Ä–∞–∑.</div>
    <input class="ksinp" id="ksinp" type="password" placeholder="sk-proj-..." autocomplete="off" autocorrect="off" spellcheck="false">
    <button class="ksbtn" onclick="saveKey()">üöÄ –í–æ–π—Ç–∏</button>
    <div class="kslink">–ù–µ—Ç –∫–ª—é—á–∞? <a href="https://platform.openai.com/api-keys" target="_blank">–ü–æ–ª—É—á–∏—Ç—å –Ω–∞ platform.openai.com ‚Üí</a></div>
  </div>
</div>

<div class="hdr">
  <div class="logo">StudyAI <span>‚ú¶ GPT-4o</span></div>
  <div class="hdr-right">
    <div class="ibtn" id="settingsBtn">‚öôÔ∏è</div>
  </div>
</div>
<div class="status" id="statusBar"></div>

<div class="sbar">
  <div class="pill on" data-s="auto">‚ú® –ê–≤—Ç–æ</div>
  <div class="pill ts-pill" data-s="ts3sb">üìó Touchstone SB</div>
  <div class="pill ts-pill" data-s="ts3wb">üìò Touchstone WB</div>
  <div class="pill bs-pill" data-s="bs">üóÇÔ∏è Business Studio</div>
  <div class="pill" data-s="math">üìê –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞</div>
  <div class="pill" data-s="russian">üá∑üá∫ –†—É—Å—Å–∫–∏–π —è–∑—ã–∫</div>
  <div class="pill" data-s="history">üìú –ò—Å—Ç–æ—Ä–∏—è</div>
  <div class="pill" data-s="english">üåç –ê–Ω–≥–ª–∏–π—Å–∫–∏–π –æ–±—â–∏–π</div>
  <div class="pill" data-s="german">üá©üá™ –ù–µ–º–µ—Ü–∫–∏–π</div>
  <div class="pill" data-s="french">üá´üá∑ –§—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–π</div>
  <div class="pill" data-s="kazakh">üá∞üáø –ö–∞–∑–∞—Ö—Å–∫–∏–π</div>
  <div class="pill" data-s="physics">‚öõÔ∏è –§–∏–∑–∏–∫–∞</div>
  <div class="pill" data-s="chemistry">üß™ –•–∏–º–∏—è</div>
  <div class="pill" data-s="literature">üìñ –õ–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞</div>
  <div class="pill" data-s="cs">üíª –ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ</div>
</div>

<div class="msgs" id="msgs">
  <div class="welcome" id="welcome">
    <div class="wicon">üéì</div>
    <h2>–ü—Ä–∏–≤–µ—Ç! –Ø —Ç–≤–æ–π —É—á–µ–±–Ω—ã–π –ò–ò</h2>
    <p>–ù–∞–ø–∏—à–∏ –∑–∞–¥–∞–Ω–∏–µ –∏–ª–∏ –ø—Ä–∏–∫—Ä–µ–ø–∏ —Ñ–æ—Ç–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —É—á–µ–±–Ω–∏–∫–∞ ‚Äî —Ä–µ—à—É –∏ –æ–±—ä—è—Å–Ω—é</p>
    <div class="qas">
      <div class="qa" onclick="qs(&#39;Touchstone 3 Unit 1 Lesson A: explain manner adverbs. Give examples from the book.&#39;)"><span class="qi">üìó</span>Touchstone U1: manner adverbs</div>
      <div class="qa" onclick="qs(&#39;Touchstone 3 Unit 8: explain wishes and conditionals (I wish I had, If I were). Give exercises.&#39;)"><span class="qi">üìó</span>Touchstone U8: wishes &amp; conditionals</div>
      <div class="qa" onclick="qs(&#39;–û–±—ä—è—Å–Ω–∏ —á—Ç–æ —Ç–∞–∫–æ–µ IDEF0 –∏ —Ç–∏–ø—ã —Å—Ç—Ä–µ–ª–æ–∫ –≤ Business Studio&#39;)"><span class="qi">üóÇÔ∏è</span>Business Studio: —Ç–∏–ø—ã —Å—Ç—Ä–µ–ª–æ–∫</div>
      <div class="qa" onclick="qs(&#39;–†–µ—à–∏ —É—Ä–∞–≤–Ω–µ–Ω–∏–µ: 3x¬≤ - 7x + 2 = 0. –ü–æ–∫–∞–∂–∏ –≤—Å–µ —à–∞–≥–∏.&#39;)"><span class="qi">üìê</span>–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞: –∫–≤–∞–¥—Ä–∞—Ç–Ω–æ–µ —É—Ä–∞–≤–Ω–µ–Ω–∏–µ</div>
    </div>
  </div>
</div>

<div class="prevs" id="prevs"></div>

<div class="inp-area">
  <div class="inp-row">
    <div class="inpacts">
      <label class="abtn" for="fi1">üñºÔ∏è</label>
      <input type="file" id="fi1" accept="image/*" multiple="" style="display:none">
      <label class="abtn" for="fi2">üì∑</label>
      <input type="file" id="fi2" accept="image/*" capture="environment" style="display:none">
    </div>
    <div class="twrap">
      <textarea id="ta" placeholder="–ù–∞–ø–∏—à–∏ –∑–∞–¥–∞–Ω–∏–µ –∏–ª–∏ —Å—Ñ–æ—Ç–∫–∞–π —Å—Ç—Ä–∞–Ω–∏—Ü—É..." rows="1" maxlength="5000"></textarea>
    </div>
    <button class="sbtn" id="sbtn" onclick="send()">‚û§</button>
  </div>
</div>

<div class="overlay" id="ov" onclick="ovClose(event)">
  <div class="panel">
    <div class="ph"></div>
    <div class="ptitle">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>
    <div class="sg">
      <div class="sl">–ú–æ–¥–µ–ª—å GPT</div>
      <div class="mgrid">
        <div class="mopt on" data-m="gpt-4o" onclick="pickModel(this)"><div class="mn">GPT-4o</div><div class="md">–í–∏–¥–∏—Ç —Ñ–æ—Ç–æ, –ª—É—á—à–∞—è</div></div>
        <div class="mopt" data-m="gpt-4o-mini" onclick="pickModel(this)"><div class="mn">GPT-4o mini</div><div class="md">–ë—ã—Å—Ç—Ä–µ–µ –∏ –¥–µ—à–µ–≤–ª–µ</div></div>
        <div class="mopt" data-m="o1-mini" onclick="pickModel(this)"><div class="mn">o1-mini</div><div class="md">–°–ª–æ–∂–Ω–∞—è –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞</div></div>
        <div class="mopt" data-m="gpt-4-turbo" onclick="pickModel(this)"><div class="mn">GPT-4 Turbo</div><div class="md">–ë–æ–ª—å—à–æ–π –∫–æ–Ω—Ç–µ–∫—Å—Ç</div></div>
      </div>
    </div>
    <div class="sg">
      <div class="sl">–Ø–∑—ã–∫ –æ—Ç–≤–µ—Ç–æ–≤</div>
      <select class="si" id="langSel">
        <option value="ru">üá∑üá∫ –†—É—Å—Å–∫–∏–π</option>
        <option value="kz">üá∞üáø –ö–∞–∑–∞—Ö—Å–∫–∏–π</option>
        <option value="en">üá¨üáß English</option>
      </select>
    </div>
    <button class="savebtn" onclick="saveSettings()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    <button class="clrbtn" onclick="clearChat()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å —á–∞—Ç</button>
    <button class="clrbtn" style="color:var(--warn);border-color:rgba(255,209,102,.2);background:rgba(255,209,102,.06)" onclick="changeKey()">üîë –°–º–µ–Ω–∏—Ç—å API –∫–ª—é—á</button>
    <div class="anote">–ö–ª—é—á —Ö—Ä–∞–Ω–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ —Ç–≤–æ—ë–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ ¬∑ –í –∫–æ–¥–µ –∫–ª—é—á–∞ –Ω–µ—Ç</div>
  </div>
</div>

<script>
let API_KEY = localStorage.getItem('api_key') || '';

function checkKey(){
  if(API_KEY && API_KEY.startsWith('sk-')){
    document.getElementById('keyscreen').classList.add('hidden');
  }
}

async function saveKey(){
  const val = document.getElementById('ksinp').value.trim();
  if(!val.startsWith('sk-')){
    document.getElementById('kserr').classList.add('show');
    return;
  }
  const btn = document.querySelector('.ksbtn');
  btn.textContent = '‚è≥ –ü—Ä–æ–≤–µ—Ä—è–µ–º...';
  btn.disabled = true;
  try{
    const res = await fetch('https://api.openai.com/v1/models',{headers:{'Authorization':'Bearer '+val}});
    if(!res.ok) throw new Error('bad key');
    localStorage.setItem('api_key', val);
    API_KEY = val;
    document.getElementById('keyscreen').classList.add('hidden');
    showSt('ok','‚úÖ –ö–ª—é—á —Å–æ—Ö—Ä–∞–Ω—ë–Ω! –ú–æ–∂–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è.');
    setTimeout(hideSt, 3000);
  }catch(e){
    document.getElementById('kserr').classList.add('show');
    btn.textContent = 'üöÄ –í–æ–π—Ç–∏';
    btn.disabled = false;
  }
}

let msgs=[], imgs=[], subject='auto';
let model=localStorage.getItem('model')||'gpt-4o';
let lang=localStorage.getItem('lang')||'ru';
let busy=false;

const TS3_KNOWLEDGE = `
=== TOUCHSTONE 3 ‚Äî –ü–û–õ–ù–û–ï –°–û–î–ï–†–ñ–ê–ù–ò–ï ===

–ò–ó–î–ê–¢–ï–õ–¨–°–¢–í–û: Cambridge University Press
–ê–í–¢–û–†–´: Michael McCarthy, Jeanne McCarten, Helen Sandiford
–£–†–û–í–ï–ù–¨: B1 (Intermediate)
–°–¢–†–£–ö–¢–£–†–ê: 12 Units √ó 4 Lessons (A, B, C, D) + Vocabulary Notebook + Extra Practice

--- UNIT 1: The way we are (—Å—Ç—Ä. 1‚Äì10) ---
Lesson A "People in a hurry" ‚Äî Manner adverbs & adjectives
  Grammar: manner adverbs (quickly, slowly, carefully, hard, fast, well, badly)
  ‚Üí adjective vs adverb: tight deadlines / work tightly; feel strong / feel strongly
  ‚Üí common pairs: good/well, hard/hard, fast/fast, late/late, early/early
  Vocabulary: personality & behavior (outgoing, shy, organized, impatient, reliable, arrogant, considerate, dishonest)
  Exercise —Ç–∏–ø—ã: circle correct word (tight/tightly), complete sentences

Lesson B "Are you the same person?" ‚Äî Personality adjectives + extremely/really/pretty/very
  Grammar: extremely + adj (extremely funny, pretty patient, really organized)
  ‚Üí "always + continuous" for habits: She's always telling jokes.
  
Lesson C ‚Äî "always" with continuous verb for habits; "at least" to point out positive side
  ‚Üí I'm always losing my keys. (annoying habit)
  ‚Üí At least she's always on time. (positive spin)
  
Lesson D ‚Äî Reading online student profiles; Writing a personal profile

Vocabulary Notebook: Opposites with prefixes im-, in-, un-, dis-
  impatient, inconsiderate, unreliable, disorganized, dishonest, unfriendly, incompetent

--- UNIT 2: Experiences (—Å—Ç—Ä. 11‚Äì20) ---
Lesson A "Have you ever...?" ‚Äî Present Perfect
  Grammar: have/has + past participle for life experiences
  ‚Üí Have you ever seen someone famous? Yes, I have.
  ‚Üí I've never flown a plane.
  Irregular verbs: be/was-were/been, see/saw/seen, go/went/gone, do/did/done, drive/drove/driven, eat/ate/eaten, drink/drank/drunk, fall/fell/fallen, forget/forgot/forgotten, get/got/gotten, give/gave/given, sing/sang/sung, take/took/taken, wake/woke/woken, break/broke/broken, choose/chose/chosen, speak/spoke/spoken, write/wrote/written, come/came/come, become/became/become, run/ran/run, cut/cut/cut, hurt/hurt/hurt, put/put/put

Lesson B ‚Äî Asking follow-up questions; showing interest: Really? Did you? Have you?
  ‚Üí keeping conversation going: Have you ever...? Do you...? Did you...?

Lesson C ‚Äî Short responses: That's so cool! / No way! / Are you serious?

Lesson D ‚Äî Reading travel blog; Writing about travel experiences

Vocabulary Notebook: Verb charts (base/simple past/past participle), verb categories

--- UNIT 3: Wonders of the world (—Å—Ç—Ä. 21‚Äì30) ---
Lesson A ‚Äî Superlative adjectives + superlatives with nouns
  Grammar: the + -est / the most + adj
  ‚Üí the tallest building, the most expensive restaurant
  ‚Üí How + adjective: How deep is the canyon?
  ‚Üí Superlatives with nouns: the most people, the least traffic

Lesson B ‚Äî How + adjective questions about natural features
  ‚Üí How big is the Amazon? / How long is the Great Wall?
  
Lesson C ‚Äî Short responses with really and sure to be a supportive listener
  ‚Üí Really? / Sure. / That's interesting. / I didn't know that.
  ‚Üí Superlatives for emphasis: It's the most amazing thing I've ever seen!
  
Lesson D ‚Äî Reading article about world records; Writing factual article about country

Checkpoint 1‚Äì3 (—Å—Ç—Ä. 31‚Äì32): Review Units 1‚Äì3 exercises

--- UNIT 4: Family life (—Å—Ç—Ä. 33‚Äì42) ---
Lesson A "Remember that?" ‚Äî used to for past habits
  Grammar: used to + base verb (positive, negative, question)
  ‚Üí I used to walk to school. / I didn't use to eat vegetables.
  ‚Üí Did you use to have a pet?
  ‚Üí "would" for past repeated actions: We would always have big family dinners.
  
Lesson B ‚Äî Demands parents make; have to / don't have to, make/let
  ‚Üí My parents make me do chores. / They don't let me stay out late.
  
Lesson C ‚Äî Agreeing strongly: Absolutely! Definitely! Exactly! No way!
  
Lesson D ‚Äî Reading blog about family meals; Writing a blog entry about a family memory

Vocabulary Notebook: Word webs for family vocabulary
  adopted, ex-husband, great-aunt, separated, single parent

--- UNIT 5: Food (—Å—Ç—Ä. 43‚Äì52) ---
Lesson A "Eating habits" ‚Äî Quantities: a lot of, much, many, a little, a few, some, any, no
  Grammar: countable vs uncountable nouns
  ‚Üí too much sugar, too many calories, not enough vegetables
  ‚Üí a jar of / a can of / a bag of / a bunch of
  
Lesson B ‚Äî Cooking methods & food adjectives
  Cooking: fried, boiled, steamed, grilled, baked, stir-fried, barbecued, roasted, raw, smoked, canned, dried, pickled
  Food collocations: scrambled eggs, mashed potatoes, grated cheese, dark chocolate, whole wheat bread, creamed spinach, sweet and sour pork
  
Lesson C ‚Äî Offering & refusing food: Would you like...? / I'm fine, thanks. / I'd love some.
  ‚Üí Letting other person decide: Whatever you'd like. / It's up to you.
  
Lesson D ‚Äî Reading about snacks around the world; Writing about a dish from your country

Vocabulary Notebook: Collocations ‚Äî words that go together; cooking vocabulary

Checkpoint 4‚Äì6 (—Å—Ç—Ä. 63‚Äì64): Review exercises

--- UNIT 6: Managing life (—Å—Ç—Ä. 53‚Äì62) ---
Lesson A "Making plans" ‚Äî Future forms
  Grammar: will, be going to, present continuous, simple present for future
  ‚Üí I'll call you later. (spontaneous decision)
  ‚Üí I'm going to study tonight. (plan)
  ‚Üí I'm meeting Anna at 7. (arrangement)
  ‚Üí The train leaves at 8. (scheduled)
  
Lesson B ‚Äî Problems and solutions: ought to, had better, would rather, should, have got to
  ‚Üí You ought to see a doctor. / You'd better not be late.
  ‚Üí I'd rather stay home. / I've got to finish this.
  ‚Üí make vs do collocations: make a decision/mistake/effort; do homework/research/dishes
  
Lesson C ‚Äî Ending phone conversations: I'd better go. / Catch you later. / Talk soon.
  
Lesson D ‚Äî Reading blog about multitasking; Writing advice about time management

--- UNIT 7: Relationships (—Å—Ç—Ä. 65‚Äì74) ---
Lesson A "Catching up" ‚Äî Relative clauses
  Grammar: who/that/which for defining relative clauses
  ‚Üí He's the guy who lives next door. / That's the restaurant that opened last year.
  ‚Üí Omitting relative pronoun when it's the object: He's the guy (that) I met yesterday.
  
Lesson B ‚Äî Dating: phrasal verbs get along (with), break up, go out (with), fall for, ask out
  ‚Üí How long have they been going out? / They broke up last month.
  
Lesson C ‚Äî Softening comments: kind of, sort of, a little, a bit, not that + adj
  ‚Üí She's sort of shy. / It's a bit boring. / It's not that expensive.
  ‚Üí though for contrasting: I like him, though he can be annoying.
  
Lesson D ‚Äî Reading article about online dating; Writing about circle of friends

Vocabulary Notebook: Phrasal verbs ‚Äî particles away, back, down, out, up

--- UNIT 8: What if? (—Å—Ç—Ä. 75‚Äì84) ---
Lesson A "Wishes" ‚Äî Wish + past form; Second conditional
  Grammar: I wish + past simple (present unreal wish)
  ‚Üí I wish I had more time. (I don't have time)
  ‚Üí I wish I weren't so busy. / I wish I could speak Spanish.
  Second conditional: If + past simple ... would/could/might + base verb
  ‚Üí If I had more money, I'd travel the world.
  ‚Üí If she lived closer, she'd be able to help.
  ‚Üí If we could afford it, we wouldn't rent.
  Common error: NOT "If I would have..." ‚Üí correct: "If I had..."
  Note: "I wish I was" acceptable in spoken English, "I wish I were" more formal

Lesson B ‚Äî Imaginary situations; more second conditional practice
  ‚Üí What would you do if you won the lottery?
  ‚Üí I'd probably buy a house. / I might travel.
  
Lesson C ‚Äî Two-part responses to surprising news
  ‚Üí That's incredible! / I don't believe it! / You're kidding!
  
Lesson D ‚Äî Reading about unusual what-if scenarios; Writing about a wish

Checkpoint 7‚Äì9 (—Å—Ç—Ä. 95‚Äì96): Review exercises

--- UNIT 9: Tech savvy? (—Å—Ç—Ä. 85‚Äì94) ---
Lesson A ‚Äî Technology vocabulary; Questions within sentences (embedded questions)
  Grammar: Questions within questions ‚Üí indirect questions
  ‚Üí Direct: What's the problem? ‚Üí Indirect: Do you know what the problem is?
  ‚Üí Direct: Which site did you use? ‚Üí Can you remember which site you used?
  ‚Üí Direct: Is the battery charged? ‚Üí Do you know if the battery is charged?
  Word order: statement order in embedded questions (NOT: Do you know what is the problem?)
  
Lesson B "How things work" ‚Äî Separable phrasal verbs; how to / what to / where to
  Phrasal verbs (separable): turn on/off, plug in, hook up, set up, turn down/up
  ‚Üí Turn the TV on. / Turn it on. (NOT: Turn on it.)
  ‚Üí Question word + to + verb: Do you know how to turn it on?
  ‚Üí Let me show you what to do. / Do you know where to plug it in?
  
Lesson C ‚Äî Responding to technical problems; I have no idea... / I wonder...
  
Lesson D ‚Äî Reading about tech gadgets; Writing tech review

--- UNIT 10: Keeping up (—Å—Ç—Ä. 97‚Äì106) ---
Lesson A "Catching up" ‚Äî Present Perfect Continuous
  Grammar: have/has + been + -ing
  ‚Üí I've been working late every night.
  ‚Üí She's been going to pottery class since September.
  ‚Üí for vs since: for three years / since September
  ‚Üí How long have you been doing that?
  
Lesson B ‚Äî News and current events; Present Perfect vs Past Simple
  ‚Üí I've heard that... / Apparently... / I read that...
  ‚Üí Did you hear about...? / Have you seen...?
  
Lesson C ‚Äî Reacting to news: That's amazing! / How terrible! / I'm not surprised.
  
Lesson D ‚Äî Reading article; Writing news summary

--- UNIT 11: Impressions (—Å—Ç—Ä. 107‚Äì116) ---
Lesson A ‚Äî Describing people and first impressions; look/seem/appear + adjective
  ‚Üí She looks tired. / He seems nervous. / They appear to be happy.
  
Lesson B ‚Äî Modal verbs for speculating (must/might/could/can't)
  ‚Üí She must be a genius. = I'm 100% sure.
  ‚Üí She might be studying. = possible.
  ‚Üí She could be his sister. = possible.
  ‚Üí She can't be more than 12. = impossible.
  ‚Üí I bet she's... / Maybe she's... (informal)
  
Lesson C ‚Äî Conversation strategies for agreeing/disagreeing about impressions
  
Lesson D ‚Äî Reading; Writing descriptive paragraph

--- UNIT 12: In the news (—Å—Ç—Ä. 117‚Äì130+) ---
Lesson A ‚Äî News stories; Simple past passive
  Grammar: was/were + past participle
  ‚Üí Active: A student found a bag. ‚Üí Passive: A bag was found (by a student).
  ‚Üí The airport was closed. / Two bears were seen. / Millions were stolen.
  ‚Üí Use passive when doer unknown/unimportant, or to focus on receiver
  
Lesson B ‚Äî Passive voice continued; by-phrase
  
Lesson C ‚Äî Softening bad news; I'm afraid... / Unfortunately... / The thing is...
  
Lesson D ‚Äî Reading newspaper article; Writing news report

Extra Practice (—Å—Ç—Ä. 145‚Äì152): Grammar exercises for each unit
Sounds Right (—Å—Ç—Ä. 138‚Äì144): Pronunciation activities

=== WORKBOOK TOUCHSTONE 3 ===
–†–∞–±–æ—á–∞—è —Ç–µ—Ç—Ä–∞–¥—å –¥—É–±–ª–∏—Ä—É–µ—Ç —Ç–µ–º—ã Student Book —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è–º–∏:
- Grammar exercises (fill in blanks, sentence transformation, error correction)
- Vocabulary exercises (matching, crosswords, word building)
- Reading comprehension passages
- Writing practice (guided compositions)
- "About you" personal response sections
–ö–∞–∂–¥—ã–π —é–Ω–∏—Ç WB —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —é–Ω–∏—Ç—É SB –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç ~8 —Å—Ç—Ä–∞–Ω–∏—Ü —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π.

=== –ö–ê–ö –†–ï–®–ê–¢–¨ –ó–ê–î–ê–ù–ò–Ø –ò–ó TOUCHSTONE 3 ===
1. –ï—Å–ª–∏ –ø—Ä–∏—Å–ª–∞–ª–∏ –§–û–¢–û —Å—Ç—Ä–∞–Ω–∏—Ü—ã ‚Äî –ø—Ä–æ—á–∏—Ç–∞–π –∑–∞–¥–∞–Ω–∏–µ, –≤—ã–ø–æ–ª–Ω–∏ –µ–≥–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é
2. –ï—Å–ª–∏ —Å–ø—Ä–∞—à–∏–≤–∞—é—Ç –≥—Ä–∞–º–º–∞—Ç–∏–∫—É ‚Äî –æ–±—ä—è—Å–Ω–∏ –ø—Ä–∞–≤–∏–ª–æ –∏–∑ –∫–Ω–∏–≥–∏ + –¥–∞–π –ø—Ä–∏–º–µ—Ä—ã –∏–∑ —É—á–µ–±–Ω–∏–∫–∞
3. –î–ª—è fill-in-the-blank ‚Äî –¥–∞–π –≤—Å–µ –æ—Ç–≤–µ—Ç—ã —Å –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ–º –ø—Ä–∞–≤–∏–ª–∞
4. –î–ª—è conversation practice ‚Äî –Ω–∞–ø–∏—à–∏ –ø–æ–ª–Ω—ã–π –¥–∏–∞–ª–æ–≥ –ø–æ –æ–±—Ä–∞–∑—Ü—É –∏–∑ –∫–Ω–∏–≥–∏
5. –î–ª—è writing tasks ‚Äî –Ω–∞–ø–∏—à–∏ —Ç–µ–∫—Å—Ç –ø–æ —É–∫–∞–∑–∞–Ω–Ω–æ–º—É –ø–ª–∞–Ω—É
6. –í—Å–µ–≥–¥–∞ —É–∫–∞–∑—ã–≤–∞–π: Unit X, Lesson X, —Å—Ç—Ä–∞–Ω–∏—Ü–∞ X (–µ—Å–ª–∏ –∏–∑–≤–µ—Å—Ç–Ω–æ)
`;

const SP = {
  auto: '',
  ts3sb: `–ü—Ä–µ–¥–º–µ—Ç: TOUCHSTONE 3 ‚Äî STUDENT'S BOOK (Cambridge University Press, B1 Intermediate).

${TS3_KNOWLEDGE}

–ü–†–ê–í–ò–õ–ê –û–¢–í–ï–¢–ê –î–õ–Ø TOUCHSTONE 3:
‚Ä¢ –ï—Å–ª–∏ –Ω–∞ —Ñ–æ—Ç–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —É—á–µ–±–Ω–∏–∫–∞ ‚Äî –í–ù–ò–ú–ê–¢–ï–õ–¨–ù–û –ø—Ä–æ—á–∏—Ç–∞–π –≤—Å–µ –∑–∞–¥–∞–Ω–∏–µ, –≤—ã–ø–æ–ª–Ω–∏ –í–°–ï –ø—É–Ω–∫—Ç—ã
‚Ä¢ –î–ª—è –≥—Ä–∞–º–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π: –¥–∞–π –≤—Å–µ –æ—Ç–≤–µ—Ç—ã + –æ–±—ä—è—Å–Ω–∏ –ø—Ä–∞–≤–∏–ª–æ
‚Ä¢ –î–ª—è vocabulary: –¥–∞–π –ø–µ—Ä–µ–≤–æ–¥, –ø—Ä–æ–∏–∑–Ω–æ—à–µ–Ω–∏–µ, –ø—Ä–∏–º–µ—Ä –∏–∑ –∫–Ω–∏–≥–∏
‚Ä¢ –£–∫–∞–∑—ã–≤–∞–π Unit –∏ Lesson: "Unit 1 Lesson A: ..."
‚Ä¢ –û–±—ä—è—Å–Ω—è–π —Ä–∞–∑–Ω–∏—Ü—É (–Ω–∞–ø—Ä–∏–º–µ—Ä: adjective vs adverb) —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –∏–º–µ–Ω–Ω–æ –∏–∑ Touchstone 3
‚Ä¢ –î–ª—è conversations ‚Äî –ø–∏—à–∏ –ø–æ–ª–Ω—ã–µ –¥–∏–∞–ª–æ–≥–∏ –∫–∞–∫ –≤ —É—á–µ–±–Ω–∏–∫–µ
‚Ä¢ –ï—Å–ª–∏ —Å–ø—Ä–∞—à–∏–≤–∞—é—Ç –æ—Ç–≤–µ—Ç –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π exercise ‚Äî –æ—Ç–≤–µ—á–∞–π –Ω–æ–º–µ—Ä–∞–º–∏: 1. ... 2. ...`,

  ts3wb: `–ü—Ä–µ–¥–º–µ—Ç: TOUCHSTONE 3 ‚Äî WORKBOOK (Cambridge University Press).

${TS3_KNOWLEDGE}

–ü–†–ê–í–ò–õ–ê –î–õ–Ø WORKBOOK:
‚Ä¢ Workbook —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è –∫ –∫–∞–∂–¥–æ–º—É —é–Ω–∏—Ç—É Student Book
‚Ä¢ –ï—Å–ª–∏ –ø—Ä–∏—Å–ª–∞–ª–∏ —Ñ–æ—Ç–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã WB ‚Äî –ø—Ä–æ—á–∏—Ç–∞–π –∑–∞–¥–∞–Ω–∏–µ –∏ –≤—ã–ø–æ–ª–Ω–∏ –µ–≥–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é
‚Ä¢ –î–ª—è grammar exercises: –≤—ã–ø–∏—à–∏ –≤—Å–µ –æ—Ç–≤–µ—Ç—ã —Å –∫—Ä–∞—Ç–∫–∏–º –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ–º
‚Ä¢ –î–ª—è writing sections: –Ω–∞–ø–∏—à–∏ –ø–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç –ø–æ –∑–∞–¥–∞–Ω–∏—é
‚Ä¢ –î–ª—è "About you" —Å–µ–∫—Ü–∏–π: –¥–∞–π –ø—Ä–∏–º–µ—Ä–Ω—ã–π –æ—Ç–≤–µ—Ç
‚Ä¢ –í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–π: –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –ª–∏ —Ñ–æ—Ä–º–∞ –≥–ª–∞–≥–æ–ª–∞, –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ª–∏ –ø–æ—Ä—è–¥–æ–∫ —Å–ª–æ–≤`,

  bs: `–ü—Ä–µ–¥–º–µ—Ç: BUSINESS STUDIO ‚Äî –ú–û–î–ï–õ–ò–†–û–í–ê–ù–ò–ï –ë–ò–ó–ù–ï–°-–ü–†–û–¶–ï–°–°–û–í (–Æ–£—Ä–ì–£, –ú–æ–∫–µ–µ–≤ –í.–í., –ö—É–ª–∏–∫–æ–≤ –î.–°., 2013).

=== –ë–ê–ó–ê –ó–ù–ê–ù–ò–ô BUSINESS STUDIO ===
–ù–û–¢–ê–¶–ò–ò: IDEF0, BP Flowchart (–ü—Ä–æ—Ü–µ—Å—Å), Cross Functional FlowChart (–ü—Ä–æ—Ü–µ–¥—É—Ä–∞), EPC

5 –¢–ò–ü–û–í –°–¢–†–ï–õ–û–ö IDEF0:
- –í–•–û–î (Input) ‚Äî –≤—Ö–æ–¥–∏—Ç –°–õ–ï–í–ê. –ú–æ–∂–µ—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å.
- –£–ü–†–ê–í–õ–ï–ù–ò–ï (Control) ‚Äî –≤—Ö–æ–¥–∏—Ç –°–í–ï–†–•–£. –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–ê —Ö–æ—Ç—è –±—ã 1.
- –í–´–•–û–î (Output) ‚Äî –≤—ã—Ö–æ–¥–∏—Ç –°–ü–†–ê–í–ê. –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–ê —Ö–æ—Ç—è –±—ã 1.
- –ú–ï–•–ê–ù–ò–ó–ú (Mechanism) ‚Äî –≤—Ö–æ–¥–∏—Ç –°–ù–ò–ó–£ (—Ä–µ—Å—É—Ä—Å—ã/–∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–∏).
- –í–´–ó–û–í (Call) ‚Äî —Å–≤—è–∑—å —Å –¥—Ä—É–≥–æ–π –º–æ–¥–µ–ª—å—é.

–î–ò–ê–ì–†–ê–ú–ú–´ IDEF0: –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–∞—è (A-0, –æ–¥–Ω–∞ –Ω–∞ –º–æ–¥–µ–ª—å) ‚Üí –î–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏–∏ (A0, A1, A2...) ‚Üí –î–µ—Ä–µ–≤–∞ —É–∑–ª–æ–≤ ‚Üí FEO

–¢–ò–ü–´ –ü–†–û–¶–ï–°–°–û–í –í –ù–ê–í–ò–ì–ê–¢–û–†–ï:
–ü–∞–ø–∫–∞ ‚Üí IDEF0 ‚Üí –ü—Ä–æ—Ü–µ—Å—Å ‚Üí –ü—Ä–æ—Ü–µ–¥—É—Ä–∞ ‚Üí –î–µ–π—Å—Ç–≤–∏–µ (–Ω–µ–¥–µ–ª–∏–º–æ–µ)
–†–µ—à–µ–Ω–∏–µ (—Ä–æ–º–±) ‚Üí –°—Å—ã–ª–∫–∞; EPC-–ø—Ä–æ—Ü–µ—Å—Å—ã

–ù–û–¢–ê–¶–ò–Ø ¬´–ü–†–û–¶–ï–°–°¬ª (BP Flowchart):
–ü—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫=–ø—Ä–æ—Ü–µ—Å—Å, –†–æ–º–±=—Ä–µ—à–µ–Ω–∏–µ (–î–∞/–ù–µ—Ç), –û–≤–∞–ª=—Å–æ–±—ã—Ç–∏–µ (–Ω–∞—á–∞–ª–æ/–∫–æ–Ω–µ—Ü)

–°–ü–†–ê–í–û–ß–ù–ò–ö ¬´–°–£–ë–™–ï–ö–¢–´¬ª: –î–æ–ª–∂–Ω–æ—Å—Ç—å, –ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ, –í–Ω–µ—à–Ω–∏–π —Å—É–±—ä–µ–∫—Ç, –†–æ–ª—å

–¢–£–ù–ù–ï–õ–ò–†–û–í–ê–ù–ò–ï: –∑–∞—Ç—É–Ω–Ω–µ–ª–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä–µ–ª–∫–∞ (–ø–æ–ª—ã–π –Ω–∞–∫–æ–Ω–µ—á–Ω–∏–∫) –ù–ï –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –Ω–∞ —É—Ä–æ–≤–µ–Ω—å –≤—ã—à–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

–£–ß–ï–ë–ù–´–ô –ü–†–ò–ú–ï–† ‚Äî –∫–æ–º–ø–∞–Ω–∏—è –ø–æ —Å–±–æ—Ä–∫–µ –ü–ö:
–ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ ¬´–î–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∫–æ–º–ø–∞–Ω–∏–∏¬ª:
  Input: –ó–≤–æ–Ω–∫–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤ | Control: –ü—Ä–∞–≤–∏–ª–∞ –∏ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã | Output: –ü—Ä–æ–¥–∞–Ω–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã | Mechanism: –ë—É—Ö–≥–∞–ª—Ç–µ—Ä—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞
–î–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—è A0 (3 —Ä–∞–±–æ—Ç—ã): –ü—Ä–æ–¥–∞–∂–∏ –∏ –º–∞—Ä–∫–µ—Ç–∏–Ω–≥ / –°–±–æ—Ä–∫–∞ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ / –û—Ç–≥—Ä—É–∑–∫–∞ –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ
–î–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—è A2 (4 —Ä–∞–±–æ—Ç—ã): –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è / –°–±–æ—Ä–∫–∞ –Ω–∞—Å—Ç–æ–ª—å–Ω—ã—Ö –ü–ö / –°–±–æ—Ä–∫–∞ –Ω–æ—É—Ç–±—É–∫–æ–≤ / –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–°–ê–ú–û–°–¢–û–Ø–¢–ï–õ–¨–ù–´–ï –ó–ê–î–ê–ù–ò–Ø (–∞–ø—Ç–µ—á–Ω—ã–π –ø—É–Ω–∫—Ç):
–ü—Ä–æ—Ü–µ—Å—Å—ã: –ü—Ä–∏–µ–º –∑–∞—è–≤–æ–∫ / –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞—è–≤–æ–∫ / –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞—è–≤–æ–∫ –Ω–∞ –ø–æ—Å—Ç–∞–≤–∫—É / –ü—Ä–∏–µ–º –ª–µ–∫–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Å—Ä–µ–¥—Å—Ç–≤ / –•—Ä–∞–Ω–µ–Ω–∏–µ –ª–µ–∫–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Å—Ä–µ–¥—Å—Ç–≤`,

  math: `–ü—Ä–µ–¥–º–µ—Ç: –ú–ê–¢–ï–ú–ê–¢–ò–ö–ê.\n- –£—Å–ª–æ–≤–∏–µ ‚Üí –†–µ—à–µ–Ω–∏–µ –ø–æ—à–∞–≥–æ–≤–æ ‚Üí –ü—Ä–æ–≤–µ—Ä–∫–∞\n- –§–æ—Ä–º—É–ª—ã –≤ —á–∏—Ç–∞–µ–º–æ–º –≤–∏–¥–µ: x¬≤ + 2x - 3 = 0`,
  russian: `–ü—Ä–µ–¥–º–µ—Ç: –†–£–°–°–ö–ò–ô –Ø–ó–´–ö.\n- –£–¥–∞—Ä–µ–Ω–∏—è –ø–æ –Ω–æ—Ä–º–∞–º –†–ê–ù (–ó–∞–ª–∏–∑–Ω—è–∫, –†–µ–∑–Ω–∏—á–µ–Ω–∫–æ): –¥–æ–≥–æ–≤–û—Ä, –∑–≤–æ–Ω–ò—Ç\n- –†–∞–∑–ª–∏—á–∞–π: –Ω–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–π / –¥–æ–ø—É—Å—Ç–∏–º—ã–π / —É—Å—Ç–∞—Ä–µ–≤—à–∏–π\n- –û—Ä—Ñ–æ–≥—Ä–∞—Ñ–∏—è: –ø—Ä–∞–≤–∏–ª–æ + –∏—Å–∫–ª—é—á–µ–Ω–∏—è + –ø—Ä–∏–º–µ—Ä—ã`,
  history: `–ü—Ä–µ–¥–º–µ—Ç: –ò–°–¢–û–†–ò–Ø.\n- –î–∞—Ç—ã ‚Üí –£—á–∞—Å—Ç–Ω–∏–∫–∏ ‚Üí –ü—Ä–∏—á–∏–Ω—ã ‚Üí –•–æ–¥ ‚Üí –ò—Ç–æ–≥–∏`,
  english: `–ü—Ä–µ–¥–º–µ—Ç: –ê–ù–ì–õ–ò–ô–°–ö–ò–ô –Ø–ó–´–ö (–æ–±—â–∏–π).\n- Grammar: –ø—Ä–∞–≤–∏–ª–æ ‚Üí —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ ‚Üí –ø—Ä–∏–º–µ—Ä—ã ‚Üí –æ—à–∏–±–∫–∏\n- Translation: literal + literary + idioms`,
  german: `–ü—Ä–µ–¥–º–µ—Ç: –ù–ï–ú–ï–¶–ö–ò–ô –Ø–ó–´–ö.\n- –¢–∞–±–ª–∏—Ü—ã —Å–∫–ª–æ–Ω–µ–Ω–∏–π/—Å–ø—Ä—è–∂–µ–Ω–∏–π\n- –ê—Ä—Ç–∏–∫–ª–∏ –¥–ª—è –≤—Å–µ—Ö —Å—É—â–µ—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö`,
  french: `–ü—Ä–µ–¥–º–µ—Ç: –§–†–ê–ù–¶–£–ó–°–ö–ò–ô –Ø–ó–´–ö.\n- –ü—Ä–∞–≤–∏–ª–æ ‚Üí –∏—Å–∫–ª—é—á–µ–Ω–∏—è ‚Üí –ø—Ä–∏–º–µ—Ä—ã\n- –¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è –ø—Ä–æ–∏–∑–Ω–æ—à–µ–Ω–∏—è`,
  kazakh: `–ü”ô–Ω: “ö–ê–ó–ê“ö –¢–Ü–õ–Ü.\n- –ì—Ä–∞–º–º–∞—Ç–∏–∫–∞–Ω—ã –µ—Ä–µ–∂–µ–ª–µ—Ä–º–µ–Ω —Ç“Ø—Å—ñ–Ω–¥—ñ—Ä`,
  physics: `–ü—Ä–µ–¥–º–µ—Ç: –§–ò–ó–ò–ö–ê.\n- –î–∞–Ω–æ ‚Üí –ù–∞–π—Ç–∏ ‚Üí –§–æ—Ä–º—É–ª–∞ ‚Üí –ü–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å –µ–¥–∏–Ω–∏—Ü–∞–º–∏ ‚Üí –û—Ç–≤–µ—Ç`,
  chemistry: `–ü—Ä–µ–¥–º–µ—Ç: –•–ò–ú–ò–Ø.\n- –£—Ä–∞–≤–Ω–µ–Ω–∏—è —Ä–µ–∞–∫—Ü–∏–π —Å –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞–º–∏ ‚Üí —Ä–∞—Å—á—ë—Ç—ã`,
  literature: `–ü—Ä–µ–¥–º–µ—Ç: –õ–ò–¢–ï–†–ê–¢–£–†–ê.\n- –¢–µ–º–∞, –∏–¥–µ—è, –æ–±—Ä–∞–∑—ã, —Ö—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å—Ä–µ–¥—Å—Ç–≤–∞`,
  cs: `–ü—Ä–µ–¥–º–µ—Ç: –ü–†–û–ì–†–ê–ú–ú–ò–†–û–í–ê–ù–ò–ï.\n- –†–∞–±–æ—á–∏–π –∫–æ–¥ —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏ ‚Üí –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –∞–ª–≥–æ—Ä–∏—Ç–º–∞`
};

const LP={ru:'–û—Ç–≤–µ—á–∞–π –¢–û–õ–¨–ö–û –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ.',kz:'–ñ–∞—É–∞–ø—Ç–∞—Ä–¥—ã —Ç–µ–∫ “õ–∞–∑–∞“õ —Ç—ñ–ª—ñ–Ω–¥–µ –∂–∞–∑.',en:'Answer in English only.'};

function sysPrompt(){
  const subj = SP[subject]||'';
  return `–¢—ã ‚Äî —É–º–Ω—ã–π —É—á–µ–±–Ω—ã–π –ò–ò-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç.\n${LP[lang]||LP.ru}\n${subj}\n\n–û–ë–©–ò–ï –ü–†–ê–í–ò–õ–ê:\n‚Ä¢ –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä—É–π –æ—Ç–≤–µ—Ç, –Ω—É–º–µ—Ä—É–π —à–∞–≥–∏\n‚Ä¢ –§–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç: **‚úÖ –û—Ç–≤–µ—Ç: ...**\n‚Ä¢ –ï—Å–ª–∏ –∑–∞–¥–∞–Ω–∏–µ –Ω–∞ —Ñ–æ—Ç–æ ‚Äî —Ç–æ—á–Ω–æ –ø—Ä–æ—á–∏—Ç–∞–π –≤—Å—ë –∑–∞–¥–∞–Ω–∏–µ, –≤—ã–ø–æ–ª–Ω–∏ –≤—Å–µ –ø—É–Ω–∫—Ç—ã\n‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π –ø—Ä–∏–º–µ—Ä—ã`;
}

function init(){
  checkKey();
  const ta=document.getElementById('ta');
  ta.addEventListener('input',()=>{ta.style.height='auto';ta.style.height=Math.min(ta.scrollHeight,110)+'px';});
  ta.addEventListener('keydown',e=>{if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();send();}});
  document.getElementById('fi1').addEventListener('change',onFiles);
  document.getElementById('fi2').addEventListener('change',onFiles);
  document.querySelectorAll('.pill').forEach(p=>{
    p.addEventListener('click',()=>{document.querySelectorAll('.pill').forEach(x=>x.classList.remove('on'));p.classList.add('on');subject=p.dataset.s;});
  });
  document.querySelectorAll('.mopt').forEach(m=>m.classList.toggle('on',m.dataset.m===model));
  document.getElementById('langSel').value=lang;
  document.getElementById('settingsBtn').onclick=()=>document.getElementById('ov').classList.add('open');
  try{const h=JSON.parse(localStorage.getItem('ch')||'[]');if(h.length){msgs=h;document.getElementById('welcome').style.display='none';h.forEach(m=>render(m.role,m.disp||m.content,[]));}}catch(e){}
}

function onFiles(e){
  Array.from(e.target.files).forEach(f=>{
    if(!f.type.startsWith('image/')) return;
    const r=new FileReader();
    r.onload=ev=>{imgs.push({url:ev.target.result,b64:ev.target.result.split(',')[1],mime:f.type});renderPrevs();};
    r.readAsDataURL(f);
  });
  e.target.value='';
}
function renderPrevs(){const c=document.getElementById('prevs');c.innerHTML='';imgs.forEach((img,i)=>{const d=document.createElement('div');d.className='prev';d.innerHTML=`<img src="${img.url}"><div class="rm" onclick="rmImg(${i})">‚úï</div>`;c.appendChild(d);});}
function rmImg(i){imgs.splice(i,1);renderPrevs();}

async function send(){
  if(busy) return;
  const ta=document.getElementById('ta'),txt=ta.value.trim();
  if(!txt&&imgs.length===0) return;
  const curImgs=[...imgs];imgs=[];renderPrevs();
  ta.value='';ta.style.height='auto';
  document.getElementById('welcome').style.display='none';hideSt();
  render('user',txt,curImgs.map(i=>i.url));
  const parts=[];
  parts.push({type:'text',text:txt||'–†–µ—à–∏ –∑–∞–¥–∞–Ω–∏–µ –Ω–∞ —ç—Ç–æ–º —Ñ–æ—Ç–æ. –ï—Å–ª–∏ —ç—Ç–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —É—á–µ–±–Ω–∏–∫–∞ Touchstone 3 ‚Äî –≤—ã–ø–æ–ª–Ω–∏ –≤—Å–µ –∑–∞–¥–∞–Ω–∏—è –ø–æ–ª–Ω–æ—Å—Ç—å—é.'});
  curImgs.forEach(img=>parts.push({type:'image_url',image_url:{url:`data:${img.mime};base64,${img.b64}`}}));
  msgs.push({role:'user',content:parts,disp:txt,previewImgs:[]});
  const typing=showTyping();
  busy=true;document.getElementById('sbtn').disabled=true;
  try{
    const isO1=model.startsWith('o1');
    const apiMsgs=[];
    if(!isO1) apiMsgs.push({role:'system',content:sysPrompt()});
    msgs.slice(-14).forEach(m=>apiMsgs.push({role:m.role,content:m.content}));
    const body={model,messages:apiMsgs,max_tokens:3000};
    if(!isO1) body.temperature=0.2;
    const res=await fetch('https://api.openai.com/v1/chat/completions',{
      method:'POST',headers:{'Content-Type':'application/json','Authorization':`Bearer ${API_KEY}`},body:JSON.stringify(body)
    });
    const data=await res.json();
    if(!res.ok) throw new Error(data.error?.message||`HTTP ${res.status}`);
    const reply=data.choices[0].message.content;
    typing.remove();
    render('assistant',reply,[]);
    msgs.push({role:'assistant',content:reply,disp:reply,previewImgs:[]});
    saveH();
  }catch(err){
    typing.remove();
    let m=err.message;
    if(m.includes('401')) m='–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ API.';
    if(m.includes('429')) m='–ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç. –ü–æ–¥–æ–∂–¥–∏—Ç–µ 30 —Å–µ–∫.';
    if(m.includes('quota')||m.includes('billing')) m='–ò—Å—á–µ—Ä–ø–∞–Ω –±–∞–ª–∞–Ω—Å OpenAI.';
    if(m.includes('fetch')||m.includes('Network')) m='–ù–µ—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞.';
    showSt('err','‚ùå '+m);
  }
  busy=false;document.getElementById('sbtn').disabled=false;
}

function qs(text){document.getElementById('ta').value=text;send();}

function render(role,content,images=[]){
  const c=document.getElementById('msgs');
  const msg=document.createElement('div');msg.className=`msg ${role==='user'?'usr':''}`;
  const av=document.createElement('div');av.className=`av ${role==='assistant'?'aiav':'usrav'}`;av.textContent=role==='assistant'?'AI':'üë§';
  const bub=document.createElement('div');bub.className=`bub ${role==='assistant'?'aibub':'usrbub'}`;
  if(images.length===1){const img=document.createElement('img');img.src=images[0];bub.appendChild(img);}
  else if(images.length>1){const g=document.createElement('div');g.className='imgrid';images.forEach(src=>{const img=document.createElement('img');img.src=src;g.appendChild(img);});bub.appendChild(g);}
  if(role==='assistant'&&subject!=='auto'){
    const pill=document.querySelector(`.pill[data-s="${subject}"]`);
    if(pill){
      const b=document.createElement('div');
      b.className=`sbadge ${subject.startsWith('ts')?'ts-badge':subject==='bs'?'bs-badge':''}`;
      b.textContent=pill.textContent.trim();bub.appendChild(b);
    }
  }
  if(content){const t=document.createElement('div');t.innerHTML=fmt(content);bub.appendChild(t);}
  msg.appendChild(av);msg.appendChild(bub);c.appendChild(msg);scroll();
}

function fmt(t){
  if(!t) return '';
  let h=t.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
  h=h.replace(/```[\w]*\n?([\s\S]*?)```/g,(_,c)=>`<pre><code>${c.trim()}</code></pre>`);
  h=h.replace(/`([^`]+)`/g,'<code>$1</code>');
  h=h.replace(/(‚úÖ[^\n<]+)/g,'<div class="ans">$1</div>');
  h=h.replace(/\*\*([^*\n]+)\*\*/g,'<strong>$1</strong>');
  h=h.replace(/\*([^*\n]+)\*/g,'<em>$1</em>');
  h=h.replace(/((?:–®–∞–≥|Step|Unit|Lesson|Exercise|–£—Ä–æ–∫)\s*[\dABCD]+\s*[:.Ôºö]?)/gi,'<br><strong style="color:var(--accent3)">$1</strong>');
  h=h.replace(/\n\n/g,'<br><br>').replace(/\n/g,'<br>');
  return h;
}

function showTyping(){const c=document.getElementById('msgs'),el=document.createElement('div');el.className='msg';el.innerHTML='<div class="av aiav">AI</div><div class="bub aibub"><div class="typing"><span></span><span></span><span></span></div></div>';c.appendChild(el);scroll();return el;}
function scroll(){const c=document.getElementById('msgs');requestAnimationFrame(()=>{c.scrollTop=c.scrollHeight;});}
function showSt(type,text){const el=document.getElementById('statusBar');el.className='status '+type;el.textContent=text;}
function hideSt(){document.getElementById('statusBar').className='status';}
function pickModel(el){document.querySelectorAll('.mopt').forEach(m=>m.classList.remove('on'));el.classList.add('on');model=el.dataset.m;}
function saveSettings(){
  lang=document.getElementById('langSel').value;
  localStorage.setItem('model',model);localStorage.setItem('lang',lang);
  document.getElementById('ov').classList.remove('open');
  showSt('ok',`‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ ¬∑ ${model}`);setTimeout(hideSt,3000);
}
function clearChat(){
  if(!confirm('–û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é —á–∞—Ç–∞?')) return;
  msgs=[];localStorage.removeItem('ch');
  document.getElementById('msgs').innerHTML=`<div class="welcome" id="welcome"><div class="wicon">üéì</div><h2>–ü—Ä–∏–≤–µ—Ç! –Ø —Ç–≤–æ–π —É—á–µ–±–Ω—ã–π –ò–ò</h2><p>–ù–∞–ø–∏—à–∏ –∑–∞–¥–∞–Ω–∏–µ –∏–ª–∏ –ø—Ä–∏–∫—Ä–µ–ø–∏ —Ñ–æ—Ç–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —É—á–µ–±–Ω–∏–∫–∞ ‚Äî —Ä–µ—à—É –∏ –æ–±—ä—è—Å–Ω—é</p><div class="qas"><div class="qa" onclick="qs('Touchstone 3 Unit 1 Lesson A: explain manner adverbs. Give examples from the book.')"><span class="qi">üìó</span>Touchstone U1: manner adverbs</div><div class="qa" onclick="qs('Touchstone 3 Unit 8: explain wishes and conditionals (I wish I had, If I were). Give exercises.')"><span class="qi">üìó</span>Touchstone U8: wishes & conditionals</div><div class="qa" onclick="qs('–û–±—ä—è—Å–Ω–∏ —á—Ç–æ —Ç–∞–∫–æ–µ IDEF0 –∏ —Ç–∏–ø—ã —Å—Ç—Ä–µ–ª–æ–∫ –≤ Business Studio')"><span class="qi">üóÇÔ∏è</span>Business Studio: —Ç–∏–ø—ã —Å—Ç—Ä–µ–ª–æ–∫</div><div class="qa" onclick="qs('–†–µ—à–∏ —É—Ä–∞–≤–Ω–µ–Ω–∏–µ: 3x¬≤ - 7x + 2 = 0. –ü–æ–∫–∞–∂–∏ –≤—Å–µ —à–∞–≥–∏.')"><span class="qi">üìê</span>–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞: –∫–≤–∞–¥—Ä–∞—Ç–Ω–æ–µ —É—Ä–∞–≤–Ω–µ–Ω–∏–µ</div></div></div>`;
  document.getElementById('ov').classList.remove('open');
}
function changeKey(){
  localStorage.removeItem('api_key');
  API_KEY='';
  document.getElementById('ov').classList.remove('open');
  document.getElementById('ksinp').value='';
  document.getElementById('kserr').classList.remove('show');
  document.querySelector('.ksbtn').textContent='üöÄ –í–æ–π—Ç–∏';
  document.querySelector('.ksbtn').disabled=false;
  document.getElementById('keyscreen').classList.remove('hidden');
}
function ovClose(e){if(e.target===document.getElementById('ov'))document.getElementById('ov').classList.remove('open');}
function saveH(){try{const s=msgs.slice(-50).map(m=>({role:m.role,content:typeof m.content==='string'?m.content:(m.disp||''),disp:m.disp||'',previewImgs:[]}));localStorage.setItem('ch',JSON.stringify(s));}catch(e){}}
init();
</script>


</body></html>